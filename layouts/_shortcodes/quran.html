{{/*
Shortcode: quran.html
Purpose: Display single Quran verse or verse range with link and optional content
Params:
- v:(string) The verse in format "chapter:verse" (e.g., "2:8") or range "chapter:verse-verse" (e.g., "2:8-10")
- inline:(bool) default true, if false show only link
- hl:(bool) default false, adds text-highlight class
Usage: 
{{< quran v="2:8" >}} 
{{< quran v="2:8-10" hl="true" >}}
{{< quran v="2:8" inline="false" >}}
Dependencies: Requires verse pages to exist at /content/quran/{chapter}/{verse}/
Rules: Simple validation - will error if verse page does not exist
Exception: Will display error message if verse page is missing
*/}}

{{ $paramVerse := .Get "v" }}
{{ $paramInline := default "true" (.Get "inline") }}
{{ $paramHighlight := .Get "hl" }}
{{ $spanClass := cond $paramHighlight "text-highlight" "" }}

{{ $parts := split $paramVerse ":" }}
{{ $chapter := index $parts 0 }}
{{ $verseSpec := index $parts 1 }}

{{/* Parse verse specification - single or range */}}
{{ $verses := slice }}
{{ if in $verseSpec "-" }}
  {{/* Range format: 8-10 */}}
  {{ $rangeParts := split $verseSpec "-" }}
  {{ $startVerse := int (index $rangeParts 0) }}
  {{ $endVerse := int (index $rangeParts 1) }}
  {{ range seq $startVerse $endVerse }}
    {{ $verses = $verses | append (string .) }}
  {{ end }}
{{ else }}
  {{/* Single verse: 8 */}}
  {{ $verses = slice $verseSpec }}
{{ end }}

{{/* Generate output for each verse */}}
{{ range $i, $verse := $verses }}
  {{ $versePage := site.GetPage (printf "/quran/%s/%s" $chapter $verse) }}
  {{ $link := printf "/quran/%s/%s/" $chapter $verse }}
  
  {{/* Check if verse page exists */}}
  {{/* {{ if not $versePage }}
    {{ errorf "quran shortcode: Verse page not found for %s:%s. Expected file: content/quran/%s/%s.md" $chapter $verse $chapter $verse }}
  {{ end }} */}}
  
  <span class="quran-verse-reference">
    <a href="{{ $link }}" 
       class="text-decoration-none" 
       aria-label="Quran verse {{ $chapter }}:{{ $verse }}">
      {{- $chapter }}:{{ $verse -}}
    </a>
    {{- if ne $paramInline "false" -}}
      <span class="ms-1 {{ $spanClass }}" role="text">
        {{- $versePage.Plain -}}
      </span>
    {{- end -}}
  </span>
  {{- if lt $i (sub (len $verses) 1) -}}&nbsp;{{- end -}}
{{ end }}